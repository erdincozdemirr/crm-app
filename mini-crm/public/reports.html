<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniCRM - Raporlar</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;family=Fira+Code&display=swap"
        rel="stylesheet">
</head>

<body>
    <div class="container">
        <header>
            <div class="logo">MiniCRM</div>
            <nav>
                <a href="index.html">Dashboard</a>
                <a href="/test-reports/lcov-report/index.html" target="_blank">Test</a>
                <a href="reports.html" class="active">DÃ¶kÃ¼man</a>
            </nav>
        </header>

        <main style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem;">
            <!-- Sidebar list of files -->
            <aside>
                <h3 style="margin-bottom: 1rem; color: var(--accent);">ðŸ“„ Mevcut Dosyalar</h3>
                <ul class="file-list" style="list-style: none;">
                    <li onclick="loadDoc('Yapilan_Islemler_Adim_Adim.txt')">
                        <span>AdÄ±m AdÄ±m Ä°ÅŸlemler</span>
                        <span class="status-badge">Ã–NEMLÄ°</span>
                    </li>
                    <li onclick="loadDoc('README.md')">
                        <span>Proje HakkÄ±nda (Readme)</span>
                    </li>
                    <li onclick="loadDoc('Gereksinim_Analizi.txt')">Gereksinim Analizi</li>
                    <li onclick="loadDoc('User_Manual.md')">KullanÄ±cÄ± KÄ±lavuzu</li>
                    <li onclick="loadDoc('Migration_Report.md')">Migration Raporu</li>
                    <li onclick="loadDoc('ETL_Result_Report.md')">ETL SonuÃ§larÄ±</li>
                    <li onclick="loadDoc('Log_Samples.md')">Log Ã–rnekleri</li>
                    <li onclick="loadDoc('Codebase_Map.md')">Kod HaritasÄ±</li>
                </ul>

                <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #334155;">
                    <h4 style="margin-bottom: 0.5rem;">ðŸ”— DÄ±ÅŸ BaÄŸlantÄ±lar</h4>
                    <a href="/test-reports/lcov-report/index.html" target="_blank" class="btn"
                        style="width: 100%; text-align: center; margin-bottom: 0.5rem;">Test Coverage Raporu</a>
                    <a href="/api-docs" target="_blank" class="btn"
                        style="width: 100%; text-align: center; margin-bottom: 0.5rem; background-color: transparent; border: 1px solid var(--accent);">API
                        DokÃ¼mantasyonu</a>
                </div>
            </aside>

            <!-- Viewer -->
            <section>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2 id="doc-title">DokÃ¼man Ã–nizleme</h2>
                    <a id="download-link" href="#" target="_blank" style="color: var(--accent); font-size: 0.9rem;">Yeni
                        Sekmede AÃ§ â†—</a>
                </div>

                <div id="content-area" class="doc-viewer markdown-body">
                    Soldaki menÃ¼den gÃ¶rÃ¼ntÃ¼lemek istediÄŸiniz raporu seÃ§in.
                </div>
            </section>
        </main>
    </div>

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <script>
        async function loadDoc(filename) {
            const titleEl = document.getElementById('doc-title');
            const contentEl = document.getElementById('content-area');
            const linkEl = document.getElementById('download-link');

            titleEl.textContent = 'YÃ¼kleniyor...';
            contentEl.innerHTML = '<span style="color: var(--text-secondary)">Veri Ã§ekiliyor...</span>';

            try {
                const response = await fetch(`/docs/${filename}`);
                if (!response.ok) throw new Error('Dosya bulunamadÄ±');

                const text = await response.text();

                titleEl.textContent = filename;

                // Render Markdown if file is .md or .txt implies markdown structure
                if (filename.endsWith('.md') || filename.endsWith('.txt')) {
                    contentEl.innerHTML = marked.parse(text);
                } else {
                    contentEl.textContent = text;
                }

                linkEl.href = `/docs/${filename}`;

            } catch (error) {
                contentEl.innerHTML = '<span style="color: #ef4444">Hata: DokÃ¼man yÃ¼klenemedi. ' + error.message + '</span>';
            }
        }

        // Auto load from query param
        const urlParams = new URLSearchParams(window.location.search);
        const doc = urlParams.get('doc');
        if (doc) {
            loadDoc(doc);
        } else {
            // Default load the most important ones
            loadDoc('Yapilan_Islemler_Adim_Adim.txt');
        }
    </script>
</body>

</html>